<div class="card border-0 shadow-sm">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0"><i class="fas fa-calendar-plus me-2"></i>Nueva Cita</h5>
  </div>

  <div class="card-body p-4">

    <div class="mb-4 border-bottom pb-4">
      <label class="form-label fw-bold text-primary">1. Seleccionar Paciente</label>

      <app-busqueda-paciente (pacienteSeleccionado)="recibirPaciente($event)">
      </app-busqueda-paciente>

      <div *ngIf="pacienteSeleccionado"
        class="alert alert-info mt-3 d-flex align-items-center animate__animated animate__fadeIn">
        <div class="me-3">
          <i class="fas fa-user-circle fa-2x"></i>
        </div>
        <div>
          <strong>{{ pacienteSeleccionado.nombre }} {{ pacienteSeleccionado.apellido }}</strong><br>
          <small>DNI: {{ pacienteSeleccionado.usuario?.documentoIdentidad || 'No registrado' }} - Tel: {{
            pacienteSeleccionado.telefono }}</small>
        </div>
      </div>
    </div>

    <form [formGroup]="formCita" (ngSubmit)="guardarCita()">
      <label class="form-label fw-bold text-primary mb-3">2. Datos de la Consulta</label>

      <div class="row g-3">
        <div class="col-md-12">
          <label class="form-label">Odontólogo</label>
          <select class="form-select" formControlName="odontologoId"
            [class.is-invalid]="formCita.get('odontologoId')?.invalid && formCita.get('odontologoId')?.touched">
            <option value="">Seleccione un profesional...</option>
            <option *ngFor="let doc of odontologos" [value]="doc.id">
              {{ doc.nombre }} {{ doc.apellido }} ({{ doc.especialidad }})
            </option>
          </select>
          <div class="invalid-feedback">Debe seleccionar un odontólogo.</div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Fecha</label>
          <input type="date" class="form-control" formControlName="fechaCita"
            [class.is-invalid]="formCita.get('fechaCita')?.invalid && formCita.get('fechaCita')?.touched">
        </div>

        <div class="col-md-6">
          <label class="form-label">Hora</label>
          <input type="time" class="form-control" formControlName="horaCita"
            [class.is-invalid]="formCita.get('horaCita')?.invalid && formCita.get('horaCita')?.touched">
          <div class="form-text text-muted">Horario de atención según disponibilidad.</div>
        </div>

        <div class="col-12">
          <label class="form-label">Motivo de Consulta</label>
          <textarea class="form-control" rows="3" formControlName="motivo"
            placeholder="Ej: Dolor de muelas, Limpieza general..."
            [class.is-invalid]="formCita.get('motivo')?.invalid && formCita.get('motivo')?.touched"></textarea>
          <div class="invalid-feedback">El motivo es obligatorio.</div>
        </div>
      </div>

      <div *ngIf="mensajeError" class="alert alert-danger mt-3">
        <i class="fas fa-exclamation-triangle me-1"></i> {{ mensajeError }}
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <button type="button" class="btn btn-outline-secondary" (click)="cancelar()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary"
          [disabled]="cargando || formCita.invalid || !pacienteSeleccionado">
          <ng-container *ngIf="!cargando; else loadingTemplate">
            <i class="fas fa-save me-2"></i>Guardar Cita
          </ng-container>
          <ng-template #loadingTemplate>
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Guardando...
          </ng-template>
        </button>
      </div>

    </form>
  </div>
</div>